import express from 'express' ; 
// import mongoose from 'mongoose' ; 
import { CveListModel } from '../model/ListCve.js';
import { getCveListFromMyDb, getSingleCveFromMyDb, getTotalCveCountInMyDb } from '../controllers/cveController.js';

const router = express.Router() ; 




router.get('/totalCveCount' , async (req,res) => {
    try{
        console.log("came to the total count") ; 
        const totCveCount = await getTotalCveCountInMyDb() ; 
        console.log(totCveCount)
        res.json(totCveCount) ; 
    }catch(err){
        res.send(err) ; 
    }
})

router.get('/cveList' , async (req,res)=>{
    try{
        const count = req.query.count ; 
    const offset = req.query.offset ;
    const cveList = await getCveListFromMyDb(count,offset) ; 
    res.json(cveList) ; 
    }catch(err){
        res.send(err) ; 
    }
}) 

router.get('/cve/:cveId' , async (req,res) => {
    try{
        const cveId = req.params.cveId ; 
        const cve = await getSingleCveFromMyDb(cveId) ; 
        res.json(cve) ; 
    }catch(err){
        res.send(err) ; 
    }
})

























// ****************************************************************
// The below is just for testing the api of the NVD.

// router.get("/cve", async (req, res) => {
//     const response = await axios.get(
//           "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-1999-0334"
//     );
//     const data = await response.data;
//     console.log("Non blocking proved from fetching cve");
//     res.json(data);
// });

// router.get('/fromCveList', async (req,res) => {
//     const response = await axios.get("https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-1999-0334") ; 
//     const data = await response.data ; 
//     res.json(data) ;
// })



// router.get("/cveList", async (req, res) => {
//     const response = await axios.get(
//           "https://services.nvd.nist.gov/rest/json/cves/2.0"
//     );
//     const data = await response.data;
//     console.log("Non blocking proved from fetching cve list");
//     res.json(data);
// });

// ****************************************************************







export {router as cveRouter} ; 