import express from 'express';
// import mongoose from 'mongoose' ; 
import { CveListModel } from '../model/ListCve.js';
import { getCveListByScore, getCveListByYear, getCveListFromMyDb, getSingleCveFromMyDb, getTotalCveCountInMyDb } from '../controllers/cveController.js';
const router = express.Router();




router.get('/totalCveCount', async (req, res) => {
    try {
        console.log("came to the total count");
        const totCveCount = await getTotalCveCountInMyDb();
        console.log(totCveCount)
        res.json(totCveCount);
    } catch (err) {
        res.send(err);
    }
})

router.get('/cveList', async (req, res) => {
    try {
        const count = req.query.count;
        const offset = req.query.offset;
        const cveList = await getCveListFromMyDb(count, offset);
        res.json(cveList);
    } catch (err) {
        res.send(err);
    }
})

router.get('/cve', async (req, res) => {
    try {
        const cveId = req.query.cveId;
        const cve = await getSingleCveFromMyDb(cveId);
        res.json(cve);
    } catch (err) {
        res.send(err);
    }
})

// `http://localhost:${config.backendPort}/cveListByScore?score=${baseScore}&offset=${skip}&count=${resultsPerPage}`

router.get('/cveListByScore', async (req, res) => {
    try {
        const score = req.query.score;
        const offset = req.query.offset;
        const count = req.query.count;
        const cveList = await getCveListByScore(score, offset, count);
        res.json(cveList);
    } catch (err) {
        res.send(err);
    }
})


// `http://localhost:${config.backendPort}/cveListByYear?year=${baseYear}&offset=${skip}&count=${resultsPerPage}`

router.get('/cveListByYear', async (req, res) => {
    try {
        const year = req.query.year;
        const offset = req.query.offset;
        const count = req.query.count;
        const cveList = await getCveListByYear(year, offset, count);
        res.json(cveList);
    } catch (err) {
        res.send(err)
    }
})





















// ****************************************************************
// The below is just for testing the api of the NVD.

// router.get("/cve", async (req, res) => {
//     const response = await axios.get(
//           "https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-1999-0334"
//     );
//     const data = await response.data;
//     console.log("Non blocking proved from fetching cve");
//     res.json(data);
// });

// router.get('/fromCveList', async (req,res) => {
//     const response = await axios.get("https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-1999-0334") ; 
//     const data = await response.data ; 
//     res.json(data) ;
// })



// router.get("/cveList", async (req, res) => {
//     const response = await axios.get(
//           "https://services.nvd.nist.gov/rest/json/cves/2.0"
//     );
//     const data = await response.data;
//     console.log("Non blocking proved from fetching cve list");
//     res.json(data);
// });

// ****************************************************************







export { router as cveRouter }; 