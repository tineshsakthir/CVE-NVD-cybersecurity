import React from 'react'
import '../css/CveList.css'
import config from '../configuration/config';

const CveList = () => {
  // const [resultsPerPage , setResultsPerPage] = useEffect(10) ;
  // const [currentPage , setCurrentPage] = useEffect(1) ; 
  const [skip, setSkip] = React.useState(0);
  const [data, setData] = React.useState(null);
  const [resultsPerPage , setResultsPerPage] = React.useState(10) ; 
  const [totalRecords, setTotalRecords] = React.useState(0);

  React.useEffect(() => {
    fetch(`http://localhost:${config.backendPort}/totalCveCount`)
        .then(response => response.json())
        .then(res => {
          console.log("HIIIIIII")  ; 
            console.log(res)
            setTotalRecords(res);
        })
        .catch((error) => {
            console.error("Error fetching total records:", error);
        });
}, []);


React.useEffect(() => {
    fetch(`http://localhost:${config.backendPort}/cveList?count=${resultsPerPage}&offset=${skip}`)    
        .then(response => response.json())
        .then(data => {
            setData(data);
        })
        .catch((error) => {
            console.error("Error fetching CVE data:", error);
        });
}, [skip,resultsPerPage]);





const handlePlus = () => {
    setSkip(skip + 10);
};

const handleMinus = () => {
    if (skip > 0) {
        setSkip(skip - 10);
    }
};

return (
    <>
    <p>Total records:{totalRecords}</p>
        {data !== null && data.length > 0 && (
            <table>
                <thead>
                    <tr>
                        <th>CVE ID</th>
                        <th>Source Identifier</th>
                        <th>Published</th>
                        <th>Last Modified</th>
                        <th>Vulnerability Status</th>
                    </tr>
                </thead>
                <tbody>
                    {data.map((item) => (
                        <tr key={item._id}>
                            <td>{item.cveId}</td>
                            <td>{item.sourceIdentifier}</td>
                            <td>{item.published}</td>
                            <td>{item.lastModified}</td>
                            <td>{item.vulnStatus}</td>
                        </tr>
                    ))}
                </tbody>
            </table>
        )}
        <div className="button-container">
    
        <select name="" id="" onChange={(event) => {
    console.log('Event:', event);
    setResultsPerPage(event.target.value);
}}>
    <option value="10">10</option>
    <option value="20">20</option>
    <option value="30">30</option>
</select>

            <button onClick={handleMinus}>prev page</button>
            <span className="page-number">{skip / 10 + 1}</span>
            <button onClick={handlePlus}>next page</button>
        </div>
        {data !== null && data.length === 0 && <p className="message">No data available</p>}
    </>
);
}

export default CveList